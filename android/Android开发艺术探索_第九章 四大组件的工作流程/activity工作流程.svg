<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2867px" preserveAspectRatio="none" style="width:3143px;height:2867px;" version="1.1" viewBox="0 0 3143 2867" width="3143px" zoomAndPan="magnify"><defs><filter height="300%" id="f1pedx49o8q37" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="35" x2="35" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="234" x2="234" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="422.5" x2="422.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="612" x2="612" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="833" x2="833" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1068.5" x2="1068.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1244.5" x2="1244.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1442.5" x2="1442.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1823.5" x2="1823.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2091.5" x2="2091.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2277.5" x2="2277.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2478.5" x2="2478.5" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2663" x2="2663" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2846" x2="2846" y1="89.1201" y2="2776.9521"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2973" x2="2973" y1="89.1201" y2="2776.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="8" y="86.0439">Context</text><ellipse cx="35" cy="13" fill="#FF0000" filter="url(#f1pedx49o8q37)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M35,21 L35,48 M22,29 L48,29 M35,48 L22,63 M35,48 L48,63 " fill="none" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="48" x="8" y="2791.9961">Context</text><ellipse cx="35" cy="2805.0723" fill="#FF0000" filter="url(#f1pedx49o8q37)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M35,2813.0723 L35,2840.0723 M22,2821.0723 L48,2821.0723 M35,2840.0723 L22,2855.0723 M35,2840.0723 L48,2855.0723 " fill="none" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="203" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="210" y="74.0439">Activity</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="203" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="210" y="2798.9961">Activity</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="365.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="372.5" y="74.0439">Instrumentation</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="365.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="372.5" y="2798.9961">Instrumentation</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="553" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="560" y="74.0439">ActivityManager</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="114" x="553" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="100" x="560" y="2798.9961">ActivityManager</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="743" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="750" y="74.0439">IActivityManagerSingleton</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="176" x="743" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="162" x="750" y="2798.9961">IActivityManagerSingleton</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="986.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="993.5" y="74.0439">ActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="986.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="993.5" y="2798.9961">ActivityManagerService</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="1192.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="1199.5" y="74.0439">ActivityStarter</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="101" x="1192.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="87" x="1199.5" y="2798.9961">ActivityStarter</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="1360.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="1367.5" y="74.0439">ActivityStackSupervisor</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="161" x="1360.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="147" x="1367.5" y="2798.9961">ActivityStackSupervisor</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1775.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1782.5" y="74.0439">ActivityStack</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="93" x="1775.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="1782.5" y="2798.9961">ActivityStack</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="2034.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="2041.5" y="74.0439">ProcessRecord</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="2034.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="2041.5" y="2798.9961">ProcessRecord</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="2211.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="2218.5" y="74.0439">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="2211.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="2218.5" y="2798.9961">ApplicationThread</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="2449.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="2456.5" y="74.0439">Hadler</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="2449.5" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="2456.5" y="2798.9961">Hadler</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="2609" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2616" y="74.0439">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="104" x="2609" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="2616" y="2798.9961">ActivityThread</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="2774" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="2781" y="74.0439">ActivityClientRecord</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="2774" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="2781" y="2798.9961">ActivityClientRecord</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="2928" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2935" y="74.0439">LoadedApk</text><rect fill="#FEFECE" filter="url(#f1pedx49o8q37)" height="33.1201" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="2928" y="2775.9521"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="2935" y="2798.9961">LoadedApk</text><polygon fill="#A80036" points="222,118.1201,232,122.1201,222,126.1201,226,122.1201" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="35" x2="228" y1="122.1201" y2="122.1201"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="42" y="118.0181">[001]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="75" y="118.0181">startActivity()启动activity</text><polygon fill="#A80036" points="411,149.8745,421,153.8745,411,157.8745,415,153.8745" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="417" y1="153.8745" y2="153.8745"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="241" y="149.7725">[002]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="132" x="274" y="149.7725">startActivityForResult()</text><polygon fill="#A80036" points="600,181.6289,610,185.6289,600,189.6289,604,185.6289" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="423" x2="606" y1="185.6289" y2="185.6289"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="430" y="181.5269">[003]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="463" y="181.5269">execStartActivity</text><polygon fill="#A80036" points="821,213.3833,831,217.3833,821,221.3833,825,217.3833" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="612" x2="827" y1="217.3833" y2="217.3833"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="619" y="213.2813">[004]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="652" y="213.2813">ActivityManager.getService()</text><polygon fill="#A80036" points="1057,245.1377,1067,249.1377,1057,253.1377,1061,249.1377" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="833" x2="1063" y1="249.1377" y2="249.1377"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="840" y="245.0356">[005]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="873" y="245.0356">IActivityManagerSingleton.get()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1069" x2="1111" y1="281.6465" y2="281.6465"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1111" x2="1111" y1="281.6465" y2="294.6465"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1070" x2="1111" y1="294.6465" y2="294.6465"/><polygon fill="#A80036" points="1080,290.6465,1070,294.6465,1080,298.6465,1076,294.6465" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1076" y="276.79">[006]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1109" y="276.79">startActivity()</text><polygon fill="#A80036" points="1233,321.6465,1243,325.6465,1233,329.6465,1237,325.6465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1069" x2="1239" y1="325.6465" y2="325.6465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1076" y="321.5444">[007]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="119" x="1109" y="321.5444">startActivityAsUser()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1287" y1="358.1553" y2="358.1553"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1287" y1="358.1553" y2="371.1553"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246" x2="1287" y1="371.1553" y2="371.1553"/><polygon fill="#A80036" points="1256,367.1553,1246,371.1553,1256,375.1553,1252,371.1553" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1252" y="353.2988">[008]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="1285" y="353.2988">startActivityMayWait()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1287" y1="402.9097" y2="402.9097"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1287" y1="402.9097" y2="415.9097"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246" x2="1287" y1="415.9097" y2="415.9097"/><polygon fill="#A80036" points="1256,411.9097,1246,415.9097,1256,419.9097,1252,415.9097" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1252" y="398.0532">[009]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1285" y="398.0532">startActivityLocked()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1287" y1="447.6641" y2="447.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1287" y1="447.6641" y2="460.6641"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246" x2="1287" y1="460.6641" y2="460.6641"/><polygon fill="#A80036" points="1256,456.6641,1246,460.6641,1256,464.6641,1252,460.6641" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1252" y="442.8076">[010]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="1285" y="442.8076">startActivityLocked()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1287" y1="492.4185" y2="492.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1287" x2="1287" y1="492.4185" y2="505.4185"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1246" x2="1287" y1="505.4185" y2="505.4185"/><polygon fill="#A80036" points="1256,501.4185,1246,505.4185,1256,509.4185,1252,505.4185" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1252" y="487.562">[011]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="1285" y="487.562">startActivity()</text><polygon fill="#A80036" points="1431,532.4185,1441,536.4185,1431,540.4185,1435,536.4185" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1437" y1="536.4185" y2="536.4185"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1252" y="532.3164">[012]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1285" y="532.3164">startActivityUnchecked()</text><polygon fill="#A80036" points="1812,564.1729,1822,568.1729,1812,572.1729,1816,568.1729" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="1818" y1="568.1729" y2="568.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1450" y="564.0708">[013]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1483" y="564.0708">resumeFocusedStackTopActivityLocked()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1824" x2="1866" y1="600.6816" y2="600.6816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1866" x2="1866" y1="600.6816" y2="613.6816"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1825" x2="1866" y1="613.6816" y2="613.6816"/><polygon fill="#A80036" points="1835,609.6816,1825,613.6816,1835,617.6816,1831,613.6816" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1831" y="595.8252">[014]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1864" y="595.8252">resumeTopActivityUncheckedLocked()</text><polygon fill="#A80036" points="1454,640.6816,1444,644.6816,1454,648.6816,1450,644.6816" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1448" x2="1823" y1="644.6816" y2="644.6816"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1460" y="640.5796">[015]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="324" x="1493" y="640.5796">ActivityStackSupervisor:resumeTopActivityInnerLocked()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="1485" y1="677.1904" y2="677.1904"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1485" x2="1485" y1="677.1904" y2="690.1904"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1444" x2="1485" y1="690.1904" y2="690.1904"/><polygon fill="#A80036" points="1454,686.1904,1444,690.1904,1454,694.1904,1450,690.1904" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1450" y="672.334">[016]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="1483" y="672.334">startSpecificActivityLocked()</text><polygon fill="#A80036" points="2080,717.1904,2090,721.1904,2080,725.1904,2084,721.1904" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1443" x2="2086" y1="721.1904" y2="721.1904"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="1450" y="717.0884">[017]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="1483" y="717.0884">realStartActivityLocked()</text><path d="M1339,734.9448 L1339,797.9448 L1543,797.9448 L1543,744.9448 L1533,734.9448 L1339,734.9448 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1533,734.9448 L1533,744.9448 L1543,744.9448 L1533,734.9448 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="1345" y="754.8428">realStartActivityLocked</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="1345" y="772.5972">这个就是真正启动activity的方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="1345" y="790.3516">,饶了半个地球啊！</text><polygon fill="#A80036" points="2266,826.208,2276,830.208,2266,834.208,2270,830.208" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2092" x2="2272" y1="830.208" y2="830.208"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2099" y="826.106">[018]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="2132" y="826.106">getApplicationThread()</text><polygon fill="#A80036" points="2467,857.9624,2477,861.9624,2467,865.9624,2471,861.9624" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2278" x2="2473" y1="861.9624" y2="861.9624"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2285" y="857.8604">[019]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="2318" y="857.8604">scheduleLaunchActivity()</text><path d="M2115,875.7168 L2115,920.7168 L2437,920.7168 L2437,885.7168 L2427,875.7168 L2115,875.7168 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2427,875.7168 L2427,885.7168 L2437,885.7168 L2427,875.7168 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="301" x="2121" y="895.6147">ApplicationThread是ActivityThread的一个静态内部类</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="2121" y="913.3691">分发的过程使用的是Handler来分发</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="952.1028"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="952.1028" y2="952.1028"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="955.1028" y2="955.1028"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="372" x="1381" y="940.2256"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="354" x="1387" y="959.1235">准备工作:ActivityThread:performLaunchActivity才是重点</text><polygon fill="#A80036" points="2651,994.98,2661,998.98,2651,1002.98,2655,998.98" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2479" x2="2657" y1="998.98" y2="998.98"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2486" y="994.8779">[020]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="2519" y="994.8779">performLaunchActivity</text><path d="M2357,1012.7344 L2357,1164.7344 L2964,1164.7344 L2964,1022.7344 L2954,1012.7344 L2357,1012.7344 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M2954,1012.7344 L2954,1022.7344 L2964,1022.7344 L2954,1012.7344 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="265" x="2363" y="1032.6323">performLaunchActivity()方法内部的调用逻辑：</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="2363" y="1050.3867">1. 内部会先调用newActivity方法创建activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="586" x="2363" y="1068.1411">2. 接着调用loadedApk.makeApplication方法创建application并调用application的生命周期onCreate方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="274" x="2363" y="1085.8955">3. 接着调用activity.attach方法创建创建windows</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="2363" y="1103.6499">4, 接着调用mInstrumentation.callActivityOnCreate调用activity的生命周期onCreate方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="389" x="2363" y="1121.4043">5, 接着调用activity.performStart()调用activity的onStart生命周期方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="420" x="2363" y="1139.1587">6, 接着调用handleLaunchActivity();调用activity的onResume生命周期方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2367" y="1156.9131"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="1195.6467"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1195.6467" y2="1195.6467"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1198.6467" y2="1198.6467"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="376" x="1379" y="1183.7695"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="358" x="1385" y="1202.6675">ActivityThread:performLaunchActivity 第一步创建Activity</text><polygon fill="#A80036" points="434,1238.5239,424,1242.5239,434,1246.5239,430,1242.5239" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="2662" y1="1242.5239" y2="1242.5239"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="440" y="1238.4219">[021]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="473" y="1238.4219">newActivity()</text><path d="M275,1256.2783 L275,1319.2783 L566,1319.2783 L566,1266.2783 L556,1256.2783 L275,1256.2783 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M556,1256.2783 L556,1266.2783 L566,1266.2783 L556,1256.2783 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="281" y="1276.1763">从performLaunchActivity调用的newActivity方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="118" x="281" y="1293.9307">通过反射加载activity</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="228" x="281" y="1311.6851">cl.loadClass(className).newInstance()</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="1350.4187"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1350.4187" y2="1350.4187"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1353.4187" y2="1353.4187"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="638" x="1248" y="1338.5415"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="620" x="1254" y="1357.4395">ActivityThread:performLaunchActivity 第二步创建Application并调用Application生命周期onCreate()</text><polygon fill="#A80036" points="2834,1393.2959,2844,1397.2959,2834,1401.2959,2838,1397.2959" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2663" x2="2840" y1="1397.2959" y2="1397.2959"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2670" y="1393.1938">[022]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2707" y="1393.1938"/><path d="M2566,1411.0503 L2566,1545.0503 L3122,1545.0503 L3122,1421.0503 L3112,1411.0503 L2566,1411.0503 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M3112,1411.0503 L3112,1421.0503 L3122,1421.0503 L3112,1411.0503 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="525" x="2572" y="1430.9482">从performLaunchActivity调用的r.packageInfo.makeApplication(false, mInstrumentation)方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="2572" y="1448.7026">看一下详细的代码</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="429" x="2572" y="1466.457">Application app = r.packageInfo.makeApplication(false, mInstrumentation);</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="2572" y="1484.2114">r是ActivityClientRecord</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="2572" y="1501.9658">r.packageInfo是LoadedApk</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="535" x="2572" y="1519.7202">最终调用LoadedApk的makeApplication方法，创建application的时候回调用他的onCreate方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="288" x="2572" y="1537.4746">ActivityClientRecord是ActivityThread的一个内部类</text><polygon fill="#A80036" points="2961,1573.3311,2971,1577.3311,2961,1581.3311,2965,1577.3311" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2846" x2="2967" y1="1577.3311" y2="1577.3311"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2853" y="1573.229">[023]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="2890" y="1573.229"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2973" x2="3015" y1="1609.8398" y2="1609.8398"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3015" x2="3015" y1="1609.8398" y2="1622.8398"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2974" x2="3015" y1="1622.8398" y2="1622.8398"/><polygon fill="#A80036" points="2984,1618.8398,2974,1622.8398,2984,1626.8398,2980,1622.8398" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2980" y="1604.9834">[024]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="3013" y="1604.9834">makeApplication()</text><polygon fill="#A80036" points="434,1649.8398,424,1653.8398,434,1657.8398,430,1653.8398" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="2972" y1="1653.8398" y2="1653.8398"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="440" y="1649.7378">[025]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="473" y="1649.7378">callApplicationOnCreate()</text><path d="M256,1667.5942 L256,1783.5942 L585,1783.5942 L585,1677.5942 L575,1667.5942 L256,1667.5942 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M575,1667.5942 L575,1677.5942 L585,1677.5942 L575,1667.5942 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="262" y="1687.4922">Instrumentation.callApplicationOnCreate</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="262" y="1705.2466">会调用application的onCreate()方法</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="78" x="262" y="1723.001">是不是很熟悉</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="262" y="1740.7554">public void callApplicationOnCreate(Application app) {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="282" y="1758.5098">app.onCreate();</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="266" y="1776.2642">}</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="1814.9978"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1814.9978" y2="1814.9978"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1817.9978" y2="1817.9978"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="380" x="1377" y="1803.1206"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="362" x="1383" y="1822.0186">ActivityThread:performLaunchActivity 第三步创建window</text><polygon fill="#A80036" points="245,1857.875,235,1861.875,245,1865.875,241,1861.875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="2662" y1="1861.875" y2="1861.875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="251" y="1857.7729">[026]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="284" y="1857.7729">attach()</text><path d="M277,1875.6294 L277,1920.6294 L565,1920.6294 L565,1885.6294 L555,1875.6294 L277,1875.6294 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M555,1875.6294 L555,1885.6294 L565,1885.6294 L555,1875.6294 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="267" x="283" y="1895.5273">从performLaunchActivity调用的activity.attach()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="283" y="1913.2817">activity.attach():这个方法创建windows</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="1952.0154"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1952.0154" y2="1952.0154"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="1955.0154" y2="1955.0154"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="502" x="1316" y="1940.1382"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="480" x="1322" y="1959.0361">ActivityThread:performLaunchActivity 第四步调用Activity生命周期onCreate()</text><polygon fill="#A80036" points="434,1994.8926,424,1998.8926,434,2002.8926,430,1998.8926" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="428" x2="2662" y1="1998.8926" y2="1998.8926"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="440" y="1994.7905">[027]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="125" x="473" y="1994.7905">callActivityOnCreate()</text><path d="M206,2012.647 L206,2057.647 L635,2057.647 L635,2022.647 L625,2012.647 L206,2012.647 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M625,2012.647 L625,2022.647 L635,2022.647 L625,2012.647 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="212" y="2032.5449">从performLaunchActivity调用的mInstrumentation.callActivityOnCreate()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="212" y="2050.2993">这里执行activity生命周期方法onCreate()</text><polygon fill="#A80036" points="245,2086.1558,235,2090.1558,245,2094.1558,241,2090.1558" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="422" y1="2090.1558" y2="2090.1558"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="251" y="2086.0537">[028]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="284" y="2086.0537">performCreate()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="276" y1="2122.6646" y2="2122.6646"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276" x2="276" y1="2122.6646" y2="2135.6646"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="235" x2="276" y1="2135.6646" y2="2135.6646"/><polygon fill="#A80036" points="245,2131.6646,235,2135.6646,245,2139.6646,241,2135.6646" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="241" y="2117.8081">[029]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="274" y="2117.8081">onCreate()</text><path d="M139,2148.6646 L139,2175.6646 L324,2175.6646 L324,2158.6646 L314,2148.6646 L139,2148.6646 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M314,2148.6646 L314,2158.6646 L324,2158.6646 L314,2148.6646 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="145" y="2168.5625">看到了吗？onCreate()调用了</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="2207.2961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2207.2961" y2="2207.2961"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2210.2961" y2="2210.2961"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="25.7544" style="stroke: #000000; stroke-width: 2.0;" width="490" x="1322" y="2195.4189"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="468" x="1328" y="2214.3169">ActivityThread:performLaunchActivity 第五步调用Activity生命周期onStart()</text><polygon fill="#A80036" points="245,2250.1733,235,2254.1733,245,2258.1733,241,2254.1733" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="2662" y1="2254.1733" y2="2254.1733"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="251" y="2250.0713">[030]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="284" y="2250.0713">performStart()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="276" y1="2286.6821" y2="2286.6821"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276" x2="276" y1="2286.6821" y2="2299.6821"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="235" x2="276" y1="2299.6821" y2="2299.6821"/><polygon fill="#A80036" points="245,2295.6821,235,2299.6821,245,2303.6821,241,2299.6821" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="241" y="2281.8257">[031]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="274" y="2281.8257">onStart()</text><path d="M144,2312.6821 L144,2339.6821 L319,2339.6821 L319,2322.6821 L309,2312.6821 L144,2312.6821 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M309,2312.6821 L309,2322.6821 L319,2322.6821 L309,2312.6821 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="150" y="2332.5801">看到了吗？onStart()调用了</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="2372.6794"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2372.6794" y2="2372.6794"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2375.6794" y2="2375.6794"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="28.4858" style="stroke: #000000; stroke-width: 2.0;" width="590" x="1272" y="2359.4365"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="576" x="1278" y="2380.6265">ActivityThread:performLaunchActivity 第六步调用Activity生命周期onResume()  ==</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="2663" x2="2705" y1="2421.6768" y2="2421.6768"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2705" x2="2705" y1="2421.6768" y2="2434.6768"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2664" x2="2705" y1="2434.6768" y2="2434.6768"/><polygon fill="#A80036" points="2674,2430.6768,2664,2434.6768,2674,2438.6768,2670,2434.6768" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="2670" y="2416.8203">[032]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="2703" y="2416.8203">handleResumeActivity()</text><polygon fill="#A80036" points="245,2461.6768,235,2465.6768,245,2469.6768,241,2465.6768" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="239" x2="2662" y1="2465.6768" y2="2465.6768"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="251" y="2461.5747">[033]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="141" x="284" y="2461.5747">performResumeActivity()</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="234" x2="276" y1="2498.1855" y2="2498.1855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="276" x2="276" y1="2498.1855" y2="2511.1855"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="235" x2="276" y1="2511.1855" y2="2511.1855"/><polygon fill="#A80036" points="245,2507.1855,235,2511.1855,245,2515.1855,241,2511.1855" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="241" y="2493.3291">[034]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="274" y="2493.3291">onStart()</text><path d="M134,2524.1855 L134,2551.1855 L329,2551.1855 L329,2534.1855 L319,2524.1855 L134,2524.1855 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M319,2524.1855 L319,2534.1855 L329,2534.1855 L319,2524.1855 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="140" y="2544.0835">看到了吗？onResume()调用了</text><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="3128" x="3" y="2584.1829"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2584.1829" y2="2584.1829"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="3131" y1="2587.1829" y2="2587.1829"/><rect fill="#EEEEEE" filter="url(#f1pedx49o8q37)" height="28.4858" style="stroke: #000000; stroke-width: 2.0;" width="472" x="1331" y="2570.9399"/><text fill="#000000" font-family="sans-serif" font-size="15" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="458" x="1337" y="2592.1299">ActivityThread:performLaunchActivity 第七步Activity启动判断  ==</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="423" x2="465" y1="2633.1802" y2="2633.1802"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="465" x2="465" y1="2633.1802" y2="2646.1802"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="424" x2="465" y1="2646.1802" y2="2646.1802"/><polygon fill="#A80036" points="434,2642.1802,424,2646.1802,434,2650.1802,430,2646.1802" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="430" y="2628.3237">[035]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="463" y="2628.3237">checkStartActivityResult</text><path d="M241,2659.1802 L241,2757.1802 L600,2757.1802 L600,2669.1802 L590,2659.1802 L241,2659.1802 " fill="#00FFFF" filter="url(#f1pedx49o8q37)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M590,2659.1802 L590,2669.1802 L600,2669.1802 L590,2659.1802 " fill="#00FFFF" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="247" y="2679.0781">checkStartActivityResult</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="247" y="2696.8325">方法检测activity是否启动成功</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="247" y="2714.5869">看一个常见的错误</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="247" y="2732.3413">activity没有在清单文件中配置</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="247" y="2750.0957">have you declared this activity in your AndroidManifest.xml</text><!--
@startuml
actor Context #red
autonumber 1 1 "<b>[000]"
 Context-> Activity :startActivity()启动activity
Activity ->Instrumentation : startActivityForResult()

Instrumentation->ActivityManager:execStartActivity


ActivityManager->IActivityManagerSingleton:ActivityManager.getService()

IActivityManagerSingleton->ActivityManagerService:IActivityManagerSingleton.get()
ActivityManagerService ->ActivityManagerService:startActivity()
ActivityManagerService ->ActivityStarter:startActivityAsUser()

ActivityStarter->ActivityStarter:startActivityMayWait()
ActivityStarter->ActivityStarter:startActivityLocked()
ActivityStarter->ActivityStarter:startActivityLocked()
ActivityStarter->ActivityStarter:startActivity()
ActivityStarter->ActivityStackSupervisor:startActivityUnchecked()
ActivityStackSupervisor->ActivityStack:resumeFocusedStackTopActivityLocked()

ActivityStack ->ActivityStack: resumeTopActivityUncheckedLocked()
ActivityStack->ActivityStackSupervisor:ActivityStackSupervisor:resumeTopActivityInnerLocked()
ActivityStackSupervisor->ActivityStackSupervisor:startSpecificActivityLocked()
ActivityStackSupervisor->ProcessRecord:realStartActivityLocked()
note over of ActivityStackSupervisor #aqua
realStartActivityLocked
这个就是真正启动activity的方法
,饶了半个地球啊！
end note
ProcessRecord->ApplicationThread:getApplicationThread()

ApplicationThread->Hadler:scheduleLaunchActivity()
note over of ApplicationThread #aqua
ApplicationThread是ActivityThread的一个静态内部类
分发的过程使用的是Handler来分发
end note
== 准备工作:ActivityThread:performLaunchActivity才是重点 ==
Hadler->ActivityThread:performLaunchActivity
note over of ActivityThread #aqua
performLaunchActivity()方法内部的调用逻辑：
1. 内部会先调用newActivity方法创建activity
2. 接着调用loadedApk.makeApplication方法创建application并调用application的生命周期onCreate方法
3. 接着调用activity.attach方法创建创建windows
4, 接着调用mInstrumentation.callActivityOnCreate调用activity的生命周期onCreate方法
5, 接着调用activity.performStart()调用activity的onStart生命周期方法
6, 接着调用handleLaunchActivity();调用activity的onResume生命周期方法

end note
== ActivityThread:performLaunchActivity 第一步创建Activity ==
ActivityThread->Instrumentation:newActivity()
note over of Instrumentation #aqua
从performLaunchActivity调用的newActivity方法
通过反射加载activity
cl.loadClass(className).newInstance()
end note
== ActivityThread:performLaunchActivity 第二步创建Application并调用Application生命周期onCreate() ==
ActivityThread->ActivityClientRecord
note over of ActivityClientRecord #aqua
从performLaunchActivity调用的r.packageInfo.makeApplication(false, mInstrumentation)方法
看一下详细的代码
Application app = r.packageInfo.makeApplication(false, mInstrumentation);
r是ActivityClientRecord
r.packageInfo是LoadedApk
最终调用LoadedApk的makeApplication方法，创建application的时候回调用他的onCreate方法
ActivityClientRecord是ActivityThread的一个内部类
end note

ActivityClientRecord->LoadedApk
LoadedApk->LoadedApk:makeApplication()
LoadedApk->Instrumentation:callApplicationOnCreate()

note over of Instrumentation #aqua
Instrumentation.callApplicationOnCreate
会调用application的onCreate()方法
是不是很熟悉
public void callApplicationOnCreate(Application app) {
     app.onCreate();
 }
end note
== ActivityThread:performLaunchActivity 第三步创建window ==
ActivityThread->Activity:attach()
note over of Instrumentation #aqua
从performLaunchActivity调用的activity.attach()
activity.attach():这个方法创建windows
end note
== ActivityThread:performLaunchActivity 第四步调用Activity生命周期onCreate()  ==
ActivityThread->Instrumentation:callActivityOnCreate()

note over of Instrumentation #aqua
从performLaunchActivity调用的mInstrumentation.callActivityOnCreate()
这里执行activity生命周期方法onCreate()
end note

Instrumentation->Activity:performCreate()
Activity->Activity:onCreate()
note over of Activity #aqua
看到了吗？onCreate()调用了
end note
== ActivityThread:performLaunchActivity 第五步调用Activity生命周期onStart()  ==
ActivityThread->Activity:performStart()
Activity->Activity:onStart()
note over of Activity #aqua
看到了吗？onStart()调用了
end note
== == ActivityThread:performLaunchActivity 第六步调用Activity生命周期onResume()  == ==
ActivityThread->ActivityThread:handleResumeActivity()
ActivityThread->Activity:performResumeActivity()
Activity->Activity:onStart()
note over of Activity #aqua
看到了吗？onResume()调用了
end note
== == ActivityThread:performLaunchActivity 第七步Activity启动判断  == ==
Instrumentation->Instrumentation:checkStartActivityResult
note over of Instrumentation #aqua
checkStartActivityResult
方法检测activity是否启动成功
看一个常见的错误
activity没有在清单文件中配置
have you declared this activity in your AndroidManifest.xml
end note
autonumber stop
@enduml

PlantUML version 1.2018.01(Mon Jan 29 02:08:22 GMT+08:00 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1024-b02
Operating System: Windows 10
OS Version: 10.0
Default Encoding: GBK
Language: zh
Country: CN
--></g></svg>
